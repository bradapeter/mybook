## 3.8 促销

### 概念

促销规则
包含规则定义和规则利益两部分。

“优惠券”或者“促销活动”只是承载促销的外部表现形式，但是内在的促销规则通用。 
* 促销活动：
 1. 视不同模式，由平台发起或卖家发起。


优惠券有两种类型
* 私有形式的， 可以是直接关联到会员账户形式的， 可以是直接关联到会员账户在结账时选择使用
* 公开形式的，在结账时手动 ，在录入优惠券码使用。 

优惠券
 分为定义和实体两部，定义是定义规则，包括优惠券本身运作规则和优惠规则，实体是根据定义生成的每一张具体的券。这些券可以使用一次或多次（视优惠券定义），每次使用都会记录其使用历史。

促销活动

和优惠券形式不同，它不需要使用优惠券，也不需要输入优惠券码，只要规则符合就可以生效，适用于如免费领取赠品，买A送B，全站买100送10的促销之类。

促销规则
包含规则定义和规则利益两部分。

规则定义
包括资格类型、资格配置、利益类型、利益累加计算（布尔型）、基于对象类型（如无限制/全站产品，分类、指定产品、指定SKU等）、基于对象配置（即针对前面的类型进行配置）、对计算金额结果的处理方式（如四舍五入）。

规则利益
当满足前面的规则定义，表示当前购物车对象可以享受利益，利益有1~N条，不同利益还有进一步的条件限制，以便设置阶梯折扣。

规则资格
即要使用优惠券或享受促销活动等优惠时需要先具备的顾客资格。
顾客资格包括无限制（是所有注册用户）、指定会员、会员组、会员级别和自定义的查询条件等。

对象配置类型
即这些促销是针对哪些产品或服务的。

利益类型
即当顾客通过优惠券或适用促销活动时，符合顾客资格，并且所选购的单品或整单（即对象类型无限制）在对象范围时，可以获得的优惠。
优惠资源有满减金额、满折金额、减免运费、赠送积分、赠品、优惠券等。
其中的「满」可以满数量、也可以满金额。不同的组合形成一个策略。

利益累加
比如满100减10，如果不累加，则满200，也是减10；如果允许累加，则减20。

```mermaid
graph TD;
  A-->B;
  A-->C;
  B-->D;
  C-->D;
```


